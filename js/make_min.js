function xmlToString(e){var t;if(window.ActiveXObject){t=e.xml}else{t=(new XMLSerializer).serializeToString(e)}return t}function getHttpObject(){var e=null;if(window.XMLHttpRequest){e=new XMLHttpRequest}else if(window.ActiveXObject){e=new ActiveXObject("Microsoft.XMLHTTP")}else{alert("Your browser does not support XMLHTTP!")}return e}var xmlPrj="";var xmlReturn="";var url="http://pillar.pilon.co.uk:82/clientPack/info.php?key=3v3r3st&id=6598d72ef2d225ac18b294dc8acc85a2&sqlId=1";var xml="";xmlhttp=getHttpObject();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){xmlReturn=xmlhttp.responseText}};xmlhttp.open("GET",url,true);xmlhttp.send();$(function(){$.get(url,function(e){xml=$(e);var t=$("rows",xml).toArray();xmlPrj=xmlToString(t[0])})});var map;var darkerBlue=["#00415d"];var pX=0;var pY=0;var code=" ";var currId=0;var currCode=" ";var colorArray=darkerBlue;var viewApp;var backButton;var buttonKPIs;var buttonProgress;var buttonFlags;var buttonPrTeam;var buttonMap;var viewkpisn;var paneCs;var paneHs;var panePeople;var paneOperations;var paneEfficiency;var paneFlags;var viewProgress;var viewFlags;var viewPrTeam;var viewPrTeamScroll;var panePrTeam;var viewMap;var Legend;var LegendOpener;var topicSubscribe;var LegendTxt;var opener;require(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom","dojo/dom-construct","dojo/ready","dojo/on","dojo/_base/connect","dijit/registry","dojox/mobile/compat","dojo/topic","dojox/gantt/GanttChart","dojox/gantt/GanttProjectItem","dojox/gantt/GanttTaskItem","dijit/_base/manager","dojox/xml/parser","dojox/xml/DomParser","dojox/mobile/parser","dojox/mobile","dojox/mobile/FixedSplitter","dojox/mobile/Pane","dojox/mobile/TabBar","dojox/mobile/View","dojox/mobile/ScrollableView","dojox/mobile/GridLayout","dojox/mobile/Accordion","dojox/mobile/Heading","dojox/mobile/SwapView","dojox/mobile/Button","dojox/mobile/Opener","dojox/mobile/TransitionEvent","dijit/layout/ContentPane"],function(e,t,n,r,s,o,u,f,l,p,d,v,m){e("ImgWidget",[t],{path1:0,w:0,h:0,c:0,a:0,i:0,constructor:function(t,n,r,s,o,u){e.safeMixin(this,t,n,r,s,o,u);path1=t;w=n;h=r;c=s;a=o;i=u},buildRendering:function(){this.domNode=r.create("img",{src:path1,style:{width:w,height:h},"class":c,align:a,id:idul})}});e("DivWidget",[t],{bg:"",details:"",cls:"",idul:"",constructor:function(t,n,r,i){e.safeMixin(this,t,n,r,i);cls=t;bg=n;details=r;idul=i},buildRendering:function(){this.domNode=r.create("div",{id:idul,"class":cls,innerHTML:details,style:{background:bg}})}});initWidgets=function(){console.log("in init");viewApp=new dojox.mobile.View({id:"view2",style:{height:"100%"}});backButton=new dojox.mobile.Heading({id:"butonBack",back:"Projects",moveTo:"viewMeniu"});buttonKPIs=new dojox.mobile.TabBarButton({id:"kpisB",moveTo:"kpis",label:"KPIs",transition:"slide"});buttonProgress=new dojox.mobile.TabBarButton({id:"progressB",moveTo:"progress",label:"Progress",transition:"slide"});buttonFlags=new dojox.mobile.TabBarButton({id:"flagsB",moveTo:"flags",label:"Flags",transition:"slide"});buttonPrTeam=new dojox.mobile.TabBarButton({id:"prTeamB",moveTo:"prTeam",label:"Project Team",transition:"slide"});buttonMap=new dojox.mobile.TabBarButton({id:"mapB",moveTo:"map",label:"Map",transition:"slide"});viewkpisn=new dojox.mobile.SwapView({id:"kpis"});paneCs=new dijit.layout.ContentPane({id:"cs",label:"Customer Satisfaction",style:{width:"100%","margin-left":"50px"}});paneHs=new dijit.layout.ContentPane({id:"hs",label:"Health & Safety",style:{width:"100%","margin-left":"50px",display:"block"}});panePeople=new dijit.layout.ContentPane({id:"People",label:"People",style:{width:"100%","margin-left":"50px"}});paneOperations=new dijit.layout.ContentPane({id:"Operations",label:"Operations",style:{width:"100%","margin-left":"50px"}});paneEfficiency=new dijit.layout.ContentPane({id:"Efficiency",label:"Efficiency",style:{width:"100%","margin-left":"50px"}});viewProgress=new dojox.mobile.SwapView({id:"progress"});viewFlags=new dojox.mobile.SwapView({id:"flags"});viewPrTeam=new dojox.mobile.SwapView({id:"prTeam"});viewPrTeamScroll=new dojox.mobile.ScrollableView({id:"prTeamScroll",style:{height:"100%",width:"100%",overflow:"hidden","text-align":"center"}});viewMap=new dojox.mobile.SwapView({id:"map",style:{height:"100%"}})};writeCharts=function(e){AnyChart.renderingType=anychart.RenderingType.SVG_PREFERRED;var t=new AnyChart;t.width=300;t.height=200;t.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/1.7prj"+e+"sm0.xml");t.write("cs");var n=new AnyChart;n.width=300;n.height=200;n.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/2.5prj"+e+"sm0.xml");n.write("hs");var r=new AnyChart;r.width=300;r.height=200;r.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/2.7prj"+e+"sm0.xml");r.write("hs");var i=new AnyChart;i.width=300;i.height=200;i.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/2.6prj"+e+"sm0.xml");i.write("hs");var s=new AnyChart;s.width=300;s.height=200;s.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/3.3prj"+e+"sm0.xml");s.write("People");var o=new AnyChart;o.width=300;o.height=200;o.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/3.7prj"+e+"sm0.xml");o.write("People");var u=new AnyChart;u.width=300;u.height=200;u.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/3.6prj"+e+"sm0.xml");u.write("People");var a=new AnyChart;a.width=300;a.height=200;a.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/2.1prj"+e+"sm0.xml");a.write("Operations");var f=new AnyChart;f.width=300;f.height=200;f.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/2.8prj"+e+"sm0.xml");f.write("Operations");var l=new AnyChart;l.width=300;l.height=200;l.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/2.9prj"+e+"sm0.xml");l.write("Operations");var c=new AnyChart;c.width=300;c.height=200;c.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/4.4prj"+e+"sm0.xml");c.write("Efficiency");var h=new AnyChart;h.width=300;h.height=200;h.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/materials-usage.xml");h.write("Efficiency");var p=new AnyChart;p.width=300;p.height=200;p.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/chart/project-cashflow.xml");p.write("Efficiency");c.addEventListener("render",function(){window.scrollBy(0,1)});unsetCharts()};unsetCharts=function(){delete chartCs;delete chartHs1;delete chartHs2;delete chartHs3;delete chartPeople1;delete chartPeople2;delete chartPeople3;delete chartOperations1;delete chartOperations2;delete chartOperations3;delete chartEfficiency1;delete chartEfficiency2;delete chartEfficiency3};unsetPanes=function(){if(paneCs)paneCs.destroy();if(paneHs)paneHs.destroy();if(panePeople)panePeople.destroy();if(paneOperations)paneOperations.destroy();if(paneEfficiency)paneEfficiency.destroy()};writeFlags=function(e){unsetFlags();paneFlags=new dijit.layout.ContentPane({id:"FlagsChart",label:"Flags",style:{width:"100%","text-align":"center"}});viewFlags.addChild(paneFlags);var t=new AnyChart;t.id="id_flag_chart";t.bgColor="white";t.width=700;t.height=400;t.addEventListener("render",function(){window.focus()});t.setXMLFile("http://pillar.pilon.co.uk:82/reports/KPIG/kpiFlagsXml.php?projID="+e);setTimeout(function(){t.write("FlagsChart")},100);t.addEventListener("render",function(){window.scrollBy(0,-1)})};unsetFlags=function(){console.log("unset flag");if(paneFlags)paneFlags.destroy();console.log(" paneFlags unset")};placeLegend=function(){Legend=new dojox.mobile.Button({id:"legendBut",label:"Legend"},"legendButton");opener=new dojox.mobile.Opener({id:"action",style:{"float":"right"}});Legend.placeAt(backButton);opener.placeAt(Legend);$("#action").append('<div class="legendTxt"><img src="img/bluearrow.png" alt="Required/Target" title="Required/Target"><br><div>Required / Target</div><br><img src="img/current.png" alt="Current Month" title="Current Month" height="80" border="0"><br><div>Current Month</div><br><img src="img/ytd.png" alt="Year To Date Average" title="Year To Date Average" height="80" border="0" width="72"><br><div>YTD Average</div></div>');Legend.on("click",function(){console.log("a fost clicait");dijit.byId("action").show(this.domNode,["above-centered","below-centered","after","before"])})};destroyLegend=function(){console.log("destroying legend");opener.destroy();Legend.destroyRecursive()};init_map=function(e,t,n){console.log("in init map : currCode,pX,pY "+e+","+t+","+n);var r=new google.maps.LatLng(t,n);var i={zoom:8,center:new google.maps.LatLng(t,n),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("mapCnt"),i);var s=new google.maps.Marker({position:r,map:map,title:"titlu "+e});map.setCenter(r);google.maps.event.trigger(map,"resize")};createView2=function(e,t,n,r,i){console.log("view 2 creation for id="+e+" and: "+t+n+r);initWidgets();viewApp.addChild(backButton);var s=new dojox.mobile.TabBar({barType:"segmentedControl",syncWithViews:"true",fixed:"top",style:{left:"24%"}},"menuButtons");s.addChild(buttonKPIs);s.addChild(buttonProgress);s.addChild(buttonFlags);s.addChild(buttonPrTeam);s.addChild(buttonMap);backButton.addChild(s);viewApp.addChild(viewkpisn);u.connect(viewkpisn,"onBeforeTransitionIn",null,function(e,t,n,r,i){$("#progressB").removeClass("mblTabBarButtonSelected");$("#flagsB").removeClass("mblTabBarButtonSelected");$("#prTeamB").removeClass("mblTabBarButtonSelected");$("#mapB").removeClass("mblTabBarButtonSelected");placeLegend()});var o=new dojox.mobile.ScrollableView({style:{height:"1600px",width:"100%",overflow:"hidden"}});viewkpisn.addChild(o);var a=new dojox.mobile.Accordion("csAccordion");a.startup();o.addChild(a);console.log("paneCs:"+paneCs);a.addChild(paneCs);var f=new dojox.mobile.Accordion("hsAccordion");f.startup();o.addChild(f);f.addChild(paneHs);var l=new dojox.mobile.Accordion("PeopleAccordion");l.startup();o.addChild(l);l.addChild(panePeople);var c=new dojox.mobile.Accordion("OperationsAccordion");c.startup();o.addChild(c);c.addChild(paneOperations);var h=new dojox.mobile.Accordion("EfficiencyAccordion");h.startup();o.addChild(h);h.addChild(paneEfficiency);viewApp.addChild(viewProgress);u.connect(viewProgress,"onBeforeTransitionIn",null,function(e,t,n,r,i){$("#kpisB").removeClass("mblTabBarButtonSelected");$("#flagsB").removeClass("mblTabBarButtonSelected");$("#prTeamB").removeClass("mblTabBarButtonSelected");$("#mapB").removeClass("mblTabBarButtonSelected");destroyLegend()});u.connect(viewFlags,"onBeforeTransitionIn",null,function(t,n,r,i,s){$("#kpisB").removeClass("mblTabBarButtonSelected");$("#progressB").removeClass("mblTabBarButtonSelected");$("#prTeamB").removeClass("mblTabBarButtonSelected");$("#mapB").removeClass("mblTabBarButtonSelected");destroyLegend();console.log("vom scrie flags din click");setTimeout(function(){writeFlags(e)},100)});viewApp.addChild(viewFlags);viewApp.addChild(viewPrTeam);(new DivWidget("teamPhoto","","<img src='http://pillar.pilon.co.uk:82/reports/img/orgChart1/prj"+e+".png'/> ","idImgTeam")).placeAt(viewPrTeamScroll);viewPrTeam.addChild(viewPrTeamScroll);u.connect(viewPrTeam,"onBeforeTransitionIn",null,function(e,t,n,r,i){$("#kpisB").removeClass("mblTabBarButtonSelected");$("#progressB").removeClass("mblTabBarButtonSelected");$("#flagsB").removeClass("mblTabBarButtonSelected");$("#mapB").removeClass("mblTabBarButtonSelected");$("#dojox_mobile_ScrollableView_1").css("height","1600px");destroyLegend();$("#prTeamScroll").css("height","100%")});viewApp.addChild(viewMap);u.connect(viewMap,"onAfterTransitionIn",null,function(e,i,s,o,u){$("#kpisB").removeClass("mblTabBarButtonSelected");$("#progressB").removeClass("mblTabBarButtonSelected");$("#flagsB").removeClass("mblTabBarButtonSelected");$("#prTeamB").removeClass("mblTabBarButtonSelected");destroyLegend();console.log("apelare init map:currCode,pX,pY: "+t+","+n+","+r);setTimeout(function(){init_map(t,n,r)},1e3)});var d=["kpisB","progressB","flagsB","prTeamB","mapB"];topicSubscribe=p.subscribe("/dojox/mobile/viewChanged",function(i){console.log("subscribe:"+i);destroyLegend();for(var s=0;s<d.length;s++){var o=d[s];$("#"+o).removeClass("mblTabBarButtonSelected");if(o.substr(0,o.length-1)==i.id){$("#"+i.id+"B").addClass("mblTabBarButtonSelected")}}if(i.id=="kpis"){placeLegend()}if(i.id=="flags"){console.log("vom scrie flags din swipe");setTimeout(function(){writeFlags(e)},100)}if(i.id=="map"){init_map(t,n,r)}});viewApp.placeAt(i);u.connect(viewApp,"onBeforeTransitionIn",null,function(e,t,n,r,i){$("#content").css("height","100%")});viewApp.startup();a.expand(paneCs,0);f.expand(paneHs,0);l.expand(panePeople,0);c.expand(paneOperations,0);h.expand(paneEfficiency,0);viewProgress.startup();viewFlags.startup();viewPrTeam.startup();viewMap.startup();var v=document.createElement("div");v.id="mapCnt";document.getElementById("map").appendChild(v);$("#projPlace").text(t)};goToSubMenu=function(e){console.log("in goToSubMenu "+e);var t=f.byId(e);var n={moveTo:"view2",transition:"slide",transitionDir:1};var r=new dojox.mobile.TransitionEvent(t.domNode,n);r.dispatch()};s(function(){var e=new dojox.mobile.FixedSplitter({id:"view1",region:"center",orientation:"V",variablePane:"1"});var t=new dojox.mobile.Pane({id:"header"});e.addChild(t);var n=new dojox.mobile.Pane({id:"content"});n.startup();e.addChild(n);var r=new dojox.mobile.ScrollableView({id:"viewMeniu"});u.connect(r,"onAfterTransitionIn",null,function(e,t,n,r,i){$("#projPlace").text(" ");unsetPanes();viewApp.destroyRecursive();topicSubscribe.remove()});u.connect(r,"onBeforeTransitionIn",null,function(e,t,n,r,i){$("#projPlace").text(" ")});r.placeAt(n);var i=new dojox.mobile.GridLayout({cols:2,"class":"centerGrid"});i.placeAt(r);var s=dojox.xml.DomParser.parse(xmlPrj);u.connect(r,"onAfterTransitionIn",null,function(e,t,n,r,i){$(".dijitContentPane").css("height","140px")});{console.log("The file's content is: "+s);var a=$("row",s.documentElement);var l=" ";if(a.length>0){for(var c=0;c<a.length;c++){var h=colorArray.length;var p=Math.floor(Math.random()*h);var d=colorArray[p];var v="";var m="pane_"+a[c].getAttribute("id");var g=a[c].getAttribute("id");code=a[c].getAttribute("code");var y=a[c].getAttribute("address");var b="Start date: "+a[c].getAttribute("sDt");var w="Opened properties: "+a[c].getAttribute("prop");pX=a[c].getAttribute("p_x");pY=a[c].getAttribute("p_y");v+="<p><b>"+code+"</b>"+"<br>"+y+"<br>"+b+"<br>"+w+"</p>";var E=v;var S=new dijit.layout.ContentPane({id:m,code:code,pX:pX,pY:pY,idProject:g,"class":"menuItem"});o(S,"click",function(e,t){id=this.id;var r=f.byId(id);var i=this.idProject;currId=this.id;pX=this.pX;pY=this.pY;l=this.code;createView2(i,l,pX,pY,n);u.connect(viewApp,"onAfterTransitionIn",null,function(e,t,n,r,s){setTimeout(function(){writeCharts(i)},100);placeLegend();$(".dijitContentPane.mblAccordionPane").css("display","block");$(".dijitContentPane.mblAccordionPane").css("height","200px")});var s={moveTo:"view2",transition:"slide",transitionDir:1};var o=new dojox.mobile.TransitionEvent(r.domNode,s);o.dispatch()});var x=(new DivWidget("line",d,E,"idNavi")).placeAt(S);i.addChild(S)}}}e.startup();e.placeAt(document.body);$("#header").append('<div><div style="float:left"><img src="img/keepmoat_alb_mic.jpg" class="" align="" id="ImgWidget_1" widgetid="ImgWidget_1"></div><div id="projPlace" style="float:left;margin-left:27%;position:relative;top:20px;">'+l+'</div><div style="float:right"><img src="img/logobw.png" class="" align="right" id="ImgWidget_0" widgetid="ImgWidget_0"></div></div>')})})